/**
 * m5ImageViewer
 *
 * @version      1.2
 * @author       nori (norimania@gmail.com)
 * @copyright    5509 (http://5509.me/)
 * @license      The MIT License
 * @link         http://5509.me/log/m5imageviewer
 *
 * 2010-02-12 16:05
 */

if(!window.console){window.console={log:function(){},debug:function(){}};}(function(a){a.fn.m5ImgLoad=function(f,b){var e=this,c=a(this).get(0),d=new Image();d.src=c.src;(function(){if(d.complete){f.call(a(d));return;}setTimeout(arguments.callee,b||20);})();};a.fn.exShow=function(b){if(!a.support.opacity){a(this).show();}else{a(this).fadeIn(b);}return this;};a.fn.exHide=function(b){if(!a.support.opacity){a(this).hide();}else{a(this).fadeOut(b);}return this;};a.fn.m5ImageViewer=function(d){var b=a("body"),g=false,i=a.extend({duration:200},d),f=a("<div id='m5ImgViewerClose' style='display: none'></div>"),e=a("<div id='m5ImgViewerBlocker' style='display: none'></div>"),h=a(["<div id='m5ImgViewerLoading' style='display: none'>","<div id='m5ImgViewerLoadingIcon'></div>","</div>"].join(""));b.append(e,h,f);return this.each(function(){var l=a(this),k=l.find("img"),c=k.offset(),j={width:k.attr("offsetWidth"),height:k.attr("offsetHeight"),top:c.top,left:c.left};l.click(function(){c=k.offset();j={width:k.attr("offsetWidth"),height:k.attr("offsetHeight"),top:c.top,left:c.left};e.css({display:"block",width:document.body.clientWidth||document.documentElement.clientWidth,height:document.body.clientHeight||document.documentElement.clientHeight,position:"fixed",top:0,left:0});a("#m5ImgViewerClose, #m5ImgViewerBlocker").one("click",function(){a("#m5ImgViewerClose, #m5ImgViewerBlocker").unbind("click");e.css("display","none");f.exHide("fast");a("img.m5ImgViewerPrev").animate({width:j.width,height:j.height,opacity:0},{duration:i.duration,easing:"swing",complete:function(){a(this).remove();}});});h.css({display:"block",width:j.width,height:j.height,position:"absolute",top:c.top,left:c.left});a("<img src='"+l.attr("href")+"'/>").m5ImgLoad(function(){h.css("display","none");var m=a(this);_loadedSize={width:m.attr("width"),height:m.attr("height")};b.append(m.addClass("m5ImgViewerPrev").css({width:j.width,height:j.height,position:"absolute",top:j.top,left:j.left,opacity:0}).animate({width:_loadedSize.width,height:_loadedSize.height,opacity:1},{duration:i.duration,easing:"swing",complete:function(){a("#m5ImgViewerClose").css({top:j.top,left:j.left}).exShow("fast");}}));});return false;});});};})(jQuery);